<ui:composition template="../../template/template.xhtml" 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui">
    <ui:define name="content">
          <h:panelGroup id="containerPropertiesManager" layout="block" class="container">
               <p:growl showDetail="true" globalOnly="true" autoUpdate="true"/>
               <h:form id="containerPropertiesManagerForm" enctype="multipart/form-data">
               
                   <h:panelGroup class="properties-parent-info" layout="block" style="border-right: 1px solid #a8a8a8;">
                       <p:panelGrid columns="2" style="width: 100%;" columnClasses="alignTop, alignTop" styleClass="noBorders"> 
                                               
                           <h:outputLabel value="Device type name:" />
                           <h:outputText value="#{containerAttributesController.slot.name}" style="width: 100%;" />
                                                                       
                           <h:outputLabel value="Description:" />
                           <p:inputTextarea value="#{containerAttributesController.slot.description}"  rows="5" cols="51" disabled="true" style="width: 100%;"/>
                           
                           <h:outputLabel value="Parent container:" />
                           <h:outputText value="#{containerAttributesController.parentContainer}" style="width: 100%;" />
                       </p:panelGrid>
                       
                       <br/>
                       <br/>
                       
                       <p:commandButton value="History" icon="ui-icon-clock" style="float: right; margin: 10px 10px " update=":containerLogForm" oncomplete="containerLog.show()" >
                          <f:ajax event="click" listener="#{auditManager.selectEntityForLog(containerAttributesController.slot, 'SLOT')}" />
                       </p:commandButton>
                       <p:commandButton value="Back" style="float: right; margin: 10px 0px 10px 10px" ajax="false" >
                           <f:ajax event="click" listener="#{containerAttributesController.containerRedirect()}" />
                       </p:commandButton>
                       
                   </h:panelGroup>
                   
                   <h:panelGroup class="property-values" layout="block">
                      <p:commandButton id="addButton" value="Add" type="button" icon="ui-icon-plus"/>
                      <p:menu overlay="true" trigger="addButton" my="left top" at="left bottom">
                            <p:menuitem value="Property" oncomplete="addPropertyValue.show()" 
                                    actionListener="#{containerAttributesController.prepareForPropertyValueAdd}" 
                                    update=":addPropertyValueForm:addPropertyValue"/>
                            <p:menuitem value="Tag" oncomplete="containerTag.show()" update=":containerTagForm" 
                                    actionListener="#{containerAttributesController.prepareForTagAdd}"/>
                            <p:menuitem value="Artifact" oncomplete="addArtifact.show()" 
                                    actionListener="#{containerAttributesController.prepareForArtifactAdd}" 
                                    update=":addArtifactForm:addArtifact"/>
                       </p:menu>
                       <p:dataTable id="attributesDataTable" var="attribute" value="#{containerAttributesController.attributes}" style="table-layout: fixed; word-wrap: break-word;" rows="15" paginator="true" paginatorPosition="bottom">
                            <p:column headerText="Name" sortBy="#{attribute.name}">
                                <h:outputText value="#{attribute.name}" />
                            </p:column>
                
                            <p:column headerText="Value">
                                <h:outputText value="#{attribute.value}" />
                            </p:column>
                                                        
                            <p:column headerText="Unit" >
                                <h:outputText value="#{!empty attribute.unit ? attribute.unit.name : '-'}" />
                            </p:column>
                
                            <p:column headerText="Actions" width="10%">
                                <p:commandButton icon="ui-icon-pencil" title="Edit" ajax="true" rendered="#{containerAttributesController.canEdit(attribute.entity)}">
                                     <f:setPropertyActionListener value="#{attribute}" target="#{containerAttributesController.selectedAttributeToModify}" />
                                </p:commandButton>
                                <p:commandButton icon="ui-icon-trash" title="Delete" ajax="true" oncomplete="deleteAttribute.show()" rendered="#{containerAttributesController.canDelete(attribute.entity)}">
                                     <f:setPropertyActionListener value="#{attribute}" target="#{containerAttributesController.selectedAttribute}" />
                                </p:commandButton>
                                <p:commandButton icon="ui-icon-arrowthick-1-s" title="Download" ajax="false" rendered="#{attribute.hasFile}">
                                     <f:setPropertyActionListener value="#{attribute}" target="#{containerAttributesController.selectedAttribute}" />
                                     <p:fileDownload value="#{containerAttributesController.downloadFile}" />
                                </p:commandButton>
                                <p:button icon="ui-icon-extlink" target="_blank" title="Got to URL" ajax="true" rendered="#{attribute.hasURL}" href="#{attribute.value}"/>
                            </p:column>
                        </p:dataTable>
                   </h:panelGroup>
                </h:form>
        </h:panelGroup>
        
        <ui:include src="../../audit/audit-log-table.xhtml">
            <ui:param name="formId" value="containerLogForm" />
            <ui:param name="dialogTitle" value="Container Log" />
            <ui:param name="widgetName" value="containerLog" />
            <ui:param name="managedBean" value="#{containerController}" />
        </ui:include>
        
        <ui:include src="../../audit/audit-log-details.xhtml">
            <ui:param name="formId" value="logDetailsForm" />
            <ui:param name="dialogTitle" value="Long Entry Details" />
            <ui:param name="widgetName" value="logDetails" />
        </ui:include>
        
        <ui:include src="../add-or-modify-dialogs/delete-confirmation.xhtml" >
            <ui:param name="formId" value="deleteAttributeForm" />
            <ui:param name="dialogTitle" value="Delete attribute" />
            <ui:param name="widgetName" value="deleteAttribute" />
            <ui:param name="controller" value="#{containerAttributesController}" />
            <ui:param name="submitHandler" value="deleteAttribute" />
            <ui:param name="formToUpdate" value=":containerPropertiesManagerForm:attributesDataTable" />
        </ui:include>
            
        <ui:include src="../add-or-modify-dialogs/property-value.xhtml" >
            <ui:param name="formId" value="addPropertyValueForm" />
            <ui:param name="dialogTitle" value="Add new container property" />
            <ui:param name="widgetName" value="addPropertyValue" />
            <ui:param name="controller" value="#{containerAttributesController}" />
            <ui:param name="submitHandler" value="addNewPropertyValue" />
            <ui:param name="componentToUpdate" value=":containerPropertiesManagerForm:attributesDataTable" />
        </ui:include>
        
        <ui:include src="../add-or-modify-dialogs/property-value.xhtml" >
            <ui:param name="formId" value="modifyPropertyValueForm" />
            <ui:param name="dialogTitle" value="Modify container property" />
            <ui:param name="widgetName" value="modifyPropertyValue" />
            <ui:param name="controller" value="#{containerAttributesController}" />
            <ui:param name="submitHandler" value="modifyPropertyValue" />
            <ui:param name="componentToUpdate" value=":containerPropertiesManagerForm:attributesDataTable" />
        </ui:include>
        
        <ui:include src="../add-or-modify-dialogs/tag.xhtml" >
            <ui:param name="formId" value="containerTagForm" />
            <ui:param name="dialogTitle" value="Add new container tag" />
            <ui:param name="widgetName" value="containerTag" />
            <ui:param name="controller" value="#{containerAttributesController}" />
            <ui:param name="submitHandler" value="addNewTag" />
            <ui:param name="componentToUpdate" value=":containerPropertiesManagerForm:attributesDataTable" />
        </ui:include>
        
        <ui:include src="../add-or-modify-dialogs/artifact.xhtml" >
            <ui:param name="formId" value="addArtifactForm" />
            <ui:param name="dialogTitle" value="Add new container artifact" />
            <ui:param name="widgetName" value="addArtifact" />
            <ui:param name="controller" value="#{containerAttributesController}" />
            <ui:param name="submitHandler" value="addNewArtifact" />
            <ui:param name="componentToUpdate" value=":containerPropertiesManagerForm:attributesDataTable" />
        </ui:include>
        
        <ui:include src="../add-or-modify-dialogs/artifact.xhtml" >
            <ui:param name="formId" value="modifyArtifactForm" />
            <ui:param name="dialogTitle" value="Modify container artifact" />
            <ui:param name="widgetName" value="modifyArtifact" />
            <ui:param name="controller" value="#{containerAttributesController}" />
            <ui:param name="submitHandler" value="modifyArtifact" />
            <ui:param name="componentToUpdate" value=":containerPropertiesManagerForm:attributesDataTable" />
        </ui:include>   
    </ui:define>
</ui:composition>