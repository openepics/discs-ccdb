<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:cc="http://java.sun.com/jsf/composite"
      xmlns:f="http://java.sun.com/jsf/core">

    <!-- INTERFACE -->
    <cc:interface>
        <cc:attribute name="selectedComponent" required="true"/>
        <cc:attribute name="collapsed" required="false" default="true"/> 
    </cc:interface>

    <!-- IMPLEMENTATION -->
    <cc:implementation>
        <p:growl id="growl" showDetail="true"/>
        <p:panel id="sigPanel" header="Signals" toggleable="true"  style="border: 0px;" 
                 collapsed="#{cc.attrs.collapsed}"  transient="true" toggleTitle="Show Signals">

            <p:commandButton id="chans" value="Channels" update="sigtable"                             
                             action="#{channelFinderMBean.findChannels(cc.attrs.selectedComponent.name)}" 
                             rendered="false"/> 
            <p:commandButton id="sigsButton" value="Show Live Data" update="sigtable"                             
                             action="#{channelFinderMBean.onShowSignals(cc.attrs.selectedComponent.name)}" /> 
            <p:commandButton id="stop" value="Stop" update="sigtable"                            
                             action="#{channelFinderMBean.onStop()}" rendered="false"/>
            <p:ajax event="toggle" update="sigtable" listener="#{channelFinderMBean.onToggle}"  onstart="#{channelFinderMBean.onStart(cc.attrs.selectedComponent.name)}" >
                <f:setPropertyActionListener target="#{channelFinderMBean.selectedComponentName}" value="#{cc.attrs.selectedComponent.name}" />            
            </p:ajax>
            <p:dataTable id="sigtable" var="sig" value="#{channelFinderMBean.signals}">				
                <p:column id="name" headerText="Name" sortBy="#{sig.name}" >
                    <h:outputText value="#{sig.name}" title="#{sig}"/>
                </p:column>

                <p:column id="value" headerText="Value" >
                    <h:outputText value="#{sig.value}" />
                </p:column>  
                <p:column id="unit" headerText="Unit" >
                    <h:outputText value="#{sig.units}" />
                </p:column>
                <p:column id="cnt" headerText="#" >
                    <h:outputText value="#{sig.count}" />
                </p:column>
            </p:dataTable>

        </p:panel>
        <p:blockUI block="sigPanel" trigger="sigsButton" >          
            <p:graphicImage value="/resources/images/ajax-loader.gif" style="background-color: transparent" />  
        </p:blockUI>  

        <p:socket channel="/signals" >
            <p:ajax event="message" update="sigtable" listener="#{channelFinderMBean.onPush()}"/>
        </p:socket>

    </cc:implementation>
</html>