<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition 
    xmlns:ui="http://java.sun.com/jsf/facelets"   
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://java.sun.com/jsf/core"   
    xmlns:h="http://java.sun.com/jsf/html">              

    <h:form id="searchForm"  prependId="false">
        <p:contextMenu for="searchTable">  
            <p:menuitem value="Add" icon="ui-icon-plus"  update=":slotEditForm :messages" 
                        actionListener="#{installationManager.onIRecAdd}"
                        process="@this"  oncomplete="PF('editSlotDialog').show()"/>  
            <p:menuitem value="Edit" icon="ui-icon-pencil" update=":slotEditForm :messages" 
                        actionListener="#{installationManager.onIRecEdit}"
                        process="@this searchTable" oncomplete="PF('editDialog').show()"/>  
            <p:menuitem value="Delete" icon="ui-icon-trash"  
                        onclick="PF('deleteConfirm').show()"/>  
        </p:contextMenu>  

        <ui:remove> -------------------------- Search  ------------------- </ui:remove>    

        <p:dataTable id="searchTable" var="item" value="#{installationManager.objects}" 
                     scrollRows="25" scrollable="true" liveScroll="true"   scrollHeight="200"                  
                     selectionMode="single" selection="#{installationManager.selectedObject}" 
                     emptyMessage="No records found!"  filteredValue="#{installationManager.filteredObjects}"
                     rowKey="#{item.id}" >

            <f:facet name="footer">
                <p:commandButton id="addBtn" value="Add" icon="ui-icon-plus" actionListener="#{installationManager.onIRecAdd}"
                                 process="@this" update=":slotEditForm :messages"  oncomplete="PF('editDialog').show()" />
            </f:facet>
            <p:ajax event="rowSelect" listener="#{installationManager.onIRecSelect}" update=":detailsPanel :messages" />

            <p:column  headerText="Rec Number" sortBy="#{item.recordNumber}"  
                       filterBy="#{item.recordNumber}" filterMatchMode="contains">
                <h:outputText value="#{item.recordNumber}"/>
            </p:column>
            <p:column id="id" headerText="Date" sortBy="#{item.installDate}" >
                <h:outputText value="#{item.installDate}">
                    <f:convertDateTime pattern="#{msgs.dateFormat}" />
                </h:outputText>
            </p:column>
            
            <p:column  headerText="Slot" sortBy="#{item.slot.name}"  
                       filterBy="#{item.slot.name}" filterMatchMode="contains">
                <h:outputText value="#{item.slot.name}"/>
            </p:column>
            <p:column  headerText="Device" sortBy="#{item.device.serialNumber}"  
                       filterBy="#{item.device.serialNumber}" filterMatchMode="contains">
                <h:outputText value="#{item.device.serialNumber}"/>
            </p:column>
            <p:column id="desc" headerText="Notes" >
                <h:outputText value="#{item.notes}"/>
            </p:column>
            <p:column  headerText="Uninstall Date">
                <h:outputText value="#{item.uninstallDate}">
                    <f:convertDateTime pattern="#{msgs.dateFormat}" />
                </h:outputText>
            </p:column>           
            <p:column id="moddate" headerText="Date Modified" rendered="false" >
                <h:outputText value="#{item.modifiedAt}">
                    <f:convertDateTime pattern="#{msgs.dateFormat}" />
                </h:outputText>
            </p:column>
            <p:column id="modby" headerText="Modified By"  rendered="false">
                <h:outputText value="#{item.modifiedBy}" />                      
            </p:column>
        </p:dataTable>
    </h:form>

    <ui:remove> -------------------------- Add/Edit ------------------- </ui:remove>
    <p:dialog  header="Add/Edit Installation Record" widgetVar="editDialog" dynamic="true">
        <h:form id="slotEditForm" prependId="false">
            <p:panelGrid id="itemEditPanel" >
                <p:row>                       
                    <p:column><h:outputLabel value="Record Number :" /></p:column>
                    <p:column><p:inputText id="recn" value="#{installationManager.inputObject.recordNumber}" 
                                               required="true"   /> </p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="Installation Date :" /></p:column>
                    <p:column><p:calendar value="#{installationManager.inputObject.installDate}" required="true"  /> 
                    </p:column>
                </p:row>
                <p:row>                       
                    <p:column><h:outputLabel value="Notes" /></p:column>
                    <p:column><p:inputTextarea id="notes" value="#{installationManager.inputObject.notes}" 
                                               required="true"   rows="5" cols="50"  /> </p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="Slot :" /></p:column>
                    <p:column>
                        <p:selectOneMenu  value="#{installationManager.inputObject.slot}"   
                                          var="slt" converter="#{slotConverter}" 
                                          filter="true" filterMatchMode="startsWith" required="true">  
                            <f:selectItem itemLabel="Select One"  itemValue="" />
                            <f:selectItems value="#{slotManager.objects}" var="s" itemLabel="#{s.name}" itemValue="#{s}"/>
                            <p:column>  
                                #{slt.name}
                            </p:column>                                                
                            <p:column >  
                                <h:outputText value="#{slt.description}" />  
                            </p:column> 
                        </p:selectOneMenu>
                    </p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="Device :" /></p:column>
                    <p:column>
                        <p:selectOneMenu  value="#{installationManager.inputObject.device}"   
                                          var="dev" converter="#{deviceConverter}" 
                                          filter="true" filterMatchMode="startsWith" required="true">  
                            <f:selectItem itemLabel="Select One"  itemValue="" />
                            <f:selectItems value="#{deviceManager.objects}" var="s" itemLabel="#{s.serialNumber}" itemValue="#{s}"/>
                            <p:column>  
                                #{dev.serialNumber}
                            </p:column>                                                
                            <p:column >  
                                <h:outputText value="#{dev.description}" />  
                            </p:column> 
                        </p:selectOneMenu>
                    </p:column>
                </p:row>

            </p:panelGrid>
            <p:toolbar>
                <p:toolbarGroup  align="right" >                      
                    <p:commandButton value="Save" icon="ui-icon-disk" 
                                     update=":searchForm:searchTable :messages" 
                                     process="@form" actionListener="#{installationManager.onIRecSave}"
                                     oncomplete="if (!args.validationFailed &amp;&amp; args.success) PF('editDialog').hide()" /> 
                    <p:separator /> 
                    <p:commandButton value="Cancel" icon="ui-icon-close"                                         
                                     process="@this"  onclick="PF('editDialog').hide()" />
                </p:toolbarGroup>
            </p:toolbar> 
        </h:form>  
    </p:dialog>

    <ui:remove> -------------------------- Delete Slot Confirm ------------------- </ui:remove>
    <p:dialog widgetVar="deleteConfirm">  
        <f:facet name="header">  
            <h:outputText value="Delete Property"/> 
        </f:facet>
        <h:form id="compTypeDelForm" prependId="false">
            <h:outputText value="Do you really want to delete this slot?" />

            <p:separator /> 
            <p:commandButton value="Yes" style="float: left"  
                             icon="ui-icon-check"
                             process="@this" update=":searchForm:searchTable"
                             oncomplete="PF('deleteConfirm').hide()"                                                                
                             actionListener="#{installationManager.onIRecDelete}"/> 
            <p:commandButton  type="cancel" value="No" style="float: right"
                              icon="ui-icon-close"
                              update=":messages" process="@this"                                  
                              onclick="PF('deleteConfirm').hide()"  />  
        </h:form>
    </p:dialog>
</ui:composition>
