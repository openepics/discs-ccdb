<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html">

    <h:form id="#{formId}">
        <p:dialog widgetVar="#{widgetName}" id="#{widgetName}" modal="true" resizable="false" closable="false" 
                dynamic="true" styleClass="property-selection" closeOnEscape="true">
            <p:ajax event="close" resetValues="true" update="propertySelect" 
                listener="#{controller.resetPropertySelection(formId)}" oncomplete="#{resetFilter}" />

            <f:facet name="header">
                <h:outputText value="#{dialogTitle}" />
            </f:facet>

            <p:panel style="border: 0; width: 66em;">
                <p:dataTable id="propertySelect" value="#{controller.filteredProperties}" var="prop" 
                        selection="#{controller.selectedProperties}" rowKey="#{prop.id}" scrollable="true" 
                        scrollHeight="350" scrollWidth="100%" tableStyle="word-wrap: break-word;" 
                        widgetVar="propSelectTable" filteredValue="#{controller.selectionPropertiesFiltered}">
                    <p:column selectionMode="multiple" width="5%" />
                    <p:column headerText="Property" width="26%" sortBy="#{prop.name}" filterBy="#{prop.name}">
                        <h:outputText value="#{prop.name}" />
                    </p:column>
                    <p:column headerText="Description" width="45%" sortBy="#{prop.description}" 
                            filterBy="#{prop.description}" filterMatchMode="contains">
                        <h:outputText value="#{prop.description}" />
                    </p:column>
                    <p:column headerText="Data type" width="12%" sortBy="#{prop.dataType.name}" 
                            filterBy="#{prop.dataType.name}" filterMatchMode="contains">
                        <h:outputText value="#{prop.dataType.name}" />
                    </p:column>
                    <p:column headerText="Unit" width="12%" sortBy="#{prop.unit.name}" 
                            filterBy="#{prop.unit.name}" filterMatchMode="contains">
                        <h:outputText value="#{not empty prop.unit ? prop.unit.name : '-'}" />
                    </p:column>
                </p:dataTable>
            </p:panel>

            <p:panel style="text-align: right; padding: 0 1.5em 0 0; border: 0;" styleClass="dialogButtonPanel">
                <p:commandButton value="Save" id="save" styleClass="dialogButton defaultCommand" 
                        oncomplete="if (args &amp;&amp; !args.validationFailed) {PF('#{widgetName}').hide(); #{resetFilter}}" 
                        action="#{controller[submitHandler]}" update="#{componentToUpdate} propertySelect" />
                <p:commandButton value="Cancel" styleClass="dialogButton" update="propertySelect" resetValues="true" 
                        oncomplete="PF('#{widgetName}').hide(); #{resetFilter}" 
                        action="#{controller.resetPropertySelection(formId)}" />
            </p:panel>

            <p:defaultCommand target="save" />
        </p:dialog>
    </h:form>
</ui:composition>