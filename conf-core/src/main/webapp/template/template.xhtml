<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:p="http://primefaces.org/ui" 
      xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:h="http://xmlns.jcp.org/jsf/html">

    <h:head>
        <f:facet name="first"> 
            <meta http-equiv="X-UA-Compatible" content="IE=EDGE" /> 
        </f:facet> 
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />      
        <h:outputStylesheet name="./css/layout.css"/>
        <link rel="shortcut icon" href="resources/images/proteus.ico" />
        <title>Controls Configuration Database</title>
        <script type="text/javascript">
            function resizeContainerPanel() {
                var menusHeight = $('#top').outerHeight(true);
                var headerHeight = $('#containersForm\\:containersTree\\:name').outerHeight(true);
                var addSlotHeight = $('#containersForm\\:addSlot').outerHeight(true);
                var em = emHeight();

                var totalMenusHeight = menusHeight + headerHeight + addSlotHeight + 3*em;
                $('.ui-treetable-scrollable-body').css({"height":window.innerHeight-totalMenusHeight});
            }

            function resizeInstallationSlotPanel() {
                var menusHeight = $('#top').outerHeight(true);
                var headerHeight = $('#installationSlotsForm\\:installationSlotsTree\\:name').outerHeight(true);
                var addSlotHeight = $('#installationSlotsForm\\:addSlot').outerHeight(true);
                var em = emHeight();

                var totalMenusHeight = menusHeight + headerHeight + addSlotHeight + 3*em;
                $('.ui-treetable-scrollable-body').css({"height":window.innerHeight-totalMenusHeight});
            }

            function resizeHierarchiesTree() {
                var menusHeight = $('#top').outerHeight(true);
                var headerHeight = $('#hierarchies\\:tree\\:name').outerHeight(true);
                if (headerHeight != null) {
                    var em = emHeight();
                    var totalMenusHeight = menusHeight + headerHeight + 3*em;
                    $('.ui-treetable-scrollable-body').css({"height":window.innerHeight-totalMenusHeight});  
                }
            }

            function resizeEmptyColumnInHierarchies() {
                var menusHeight = $('#top').outerHeight(true);
                var em = emHeight();
                var slotAttributesTitle = $('#hierarchies\\:slotAttributesTitle').parent().outerHeight(true);
                var slotAttributesTable = $('#hierarchies\\:attributesTable').outerHeight(true);
                var slotRelationshipsTitle = $('#slotRelationshipsTitle').outerHeight(true);
                var slotRelationshipsTable = $('#hierarchies\\:relationsTable').outerHeight(true);
                var installationDetails = $('#hierarchies\\:installationDetails').outerHeight(true);

                if (installationDetails == null) { 
                    installationDetails = 0;
                }

                var totalHeight = menusHeight + 4*em  + slotAttributesTitle + slotAttributesTable + slotRelationshipsTitle + slotRelationshipsTable + installationDetails;

                $('#hierarchies\\:hierarchiesEmptyColumn').css({"height":window.innerHeight-totalHeight});
            }

            function hierarchiesResizeAll() {
                resizeHierarchiesTree();
                resizeEmptyColumnInHierarchies();
            }

            function removeParametersFromUrl() {
               window.history.pushState("", "", window.location.href.replace(window.location.search, ''));
            }

            function emHeight() {
                return $('#top').outerHeight(true) - $('#top').outerHeight();
            }

        </script>
    </h:head>

    <h:body style="overflow-x: hidden">
        <h:panelGroup id="top" layout="block">
            <ui:insert name="top">
                <h:panelGroup id="header" layout="block" rendered="#{msgs.showHeader}">
                    <ui:include src="header.xhtml" />
                </h:panelGroup>
                <h:panelGroup id="menu" layout="block">
                    <ui:include src="menu.xhtml" />
                </h:panelGroup>
            </ui:insert>
        </h:panelGroup>

        <h:panelGroup id="content" layout="block">
            <h:panelGroup rendered="#{loginManager.loggedIn}">
                <ui:insert name="content">Content</ui:insert>
            </h:panelGroup>
        </h:panelGroup>
        
        <div class="footer-message">
            <h:outputText value="#{msgs.title} v#{msgs.titleVersion} - " /><a style="color: lightgray;" href="mailto:#{msgs.supportEmail}">Contact us</a>
        </div>
        
        <p:dialog modal="true" widgetVar="statusDialog" showHeader="false" draggable="false" closable="false" 
                resizable="false">  
            <p:graphicImage value="/resources/images/ajax-loader.gif" />  
        </p:dialog>
        
        <h:form id="loginDialogForm">         
            <p:dialog id="loginDialog" widgetVar="loginDialog" modal="true" closable="false" 
                    visible="#{!loginManager.isLoggedIn()}" resizable="false">
                <f:facet name="header">
                    <h:outputText value="Sign In" />
                </f:facet>
                <p:panelGrid id="grid" columns="2" styleClass="noBorders">
                    <p:outputLabel for="userid" value="Username" />
                    <h:panelGroup>
                        <p:inputText id="userid" value="#{loginManager.userId}" label="Username" required="true" />
                        <p:watermark for="userid" value="Enter username" />
                        <p:message for="userid" />
                    </h:panelGroup>
                    <p:outputLabel for="passwd" value="Password" />
                    <h:panelGroup>
                        <p:password id="passwd" value="#{loginManager.password}" label="Password" required="true"/>
                        <p:watermark for="passwd" value="Enter password" />
                        <p:message for="passwd" />
                    </h:panelGroup>
                </p:panelGrid>
                <p:separator />
                <p:commandButton value="Sign In" update=":loginDialogForm :top :content" action="#{loginManager.onLogin}" 
                        style="float: left" />
            </p:dialog>
        </h:form>

        <script type="text/javascript">
            var footerWidth = $('.footer-message').outerWidth(true);
            $('.footer-message').css({"left":(window.innerWidth-footerWidth)/2 });
        </script>
    </h:body>
</html>
