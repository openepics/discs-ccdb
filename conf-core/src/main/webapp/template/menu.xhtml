<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:rc="http://java.sun.com/jsf/composite/comps"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions">

    <h:form id="menuform">
        <script type="text/javascript">
        // <![CDATA[
        function templateDownloadStart() {
            PF('statusDialog').show();
        }
        function templateDownloadStop() {
            PF('statusDialog').hide();
        }
        // ]]>
        </script>

        <p:growl id="menumsgs" showDetail="true" />

        <p:menubar id="mainMenu" styleClass="menubar">

            <p:menuitem value="Home" title="The main application view" url="/"
                rendered="#{not request.requestURI.endsWith('home.xhtml')}" icon="ui-icon-home" />
            <p:submenu label="Home" icon="ui-icon-home" rendered="#{request.requestURI.endsWith('home.xhtml')}"
                    styleClass="menu-selected">
                <p:menuitem value="View" title="View Home Screen" url="/" />

                <p:menuitem value="Import" update=":importSlotsForm" oncomplete="PF('importSlots').show();"
                            title="Import slots" actionListener="#{hierarchiesController.prepareImportSlotPopup()}"
                    disabled="#{not securityPolicy.getUIHint('HIERARCHY_ALL')}" />

                <p:menuitem value="Import signals" update=":importSignalsForm" title="Import signals"
                    oncomplete="PF('importSignals').show();" actionListener="#{hierarchiesController.prepareImportSignalPopup()}"
                    disabled="#{not securityPolicy.getUIHint('IMPORT_SIGNALS')}" />
            </p:submenu>

            <p:menuitem value="Devices" title="View devices" url="/devices.xhtml"
                rendered="#{not request.requestURI.endsWith('devices.xhtml')}" icon="ui-icon-gear" />
            <p:submenu label="Devices" icon="ui-icon-gear"  rendered="#{request.requestURI.endsWith('devices.xhtml')}"
                    styleClass="menu-selected">
                <p:menuitem value="View" title="View Devices" url="/devices.xhtml" />

                <p:menuitem value="Import" update=":importDevicesForm" oncomplete="PF('importDevices').show();"
                    title="Import Devices" actionListener="#{devicesController.prepareImportPopup()}"
                    disabled="#{not securityPolicy.getUIHint('DEVICES_ALL')}" />
            </p:submenu>

            <p:menuitem value="Device types" title="View device types" url="/device-types.xhtml"
                rendered="#{not request.requestURI.endsWith('device-types.xhtml')}" icon="ui-icon-wrench" />
            <p:submenu label="Device types" icon="ui-icon-wrench" rendered="#{request.requestURI.endsWith('device-types.xhtml')}"
                    styleClass="menu-selected">
                <p:menuitem value="View" title="View Device Types" url="/device-types.xhtml" />

                <p:menuitem value="Import" update=":importCompTypesForm" oncomplete="PF('importCompTypes').show();"
                    title="Import Device Types" actionListener="#{componentTypeManager.prepareImportPopup()}"
                    disabled="#{not securityPolicy.getUIHint('DEVTYPE_CREATE')}" />
            </p:submenu>

            <p:menuitem value="Properties" title="View property definitions" url="/properties.xhtml"
                rendered="#{not request.requestURI.endsWith('properties.xhtml')}" icon="ui-icon-contact" />
            <p:submenu label="Properties" icon="ui-icon-contact" rendered="#{request.requestURI.endsWith('properties.xhtml')}"
                    styleClass="menu-selected">
                <p:menuitem value="View" title="View Properties" url="/properties.xhtml" />

                <p:menuitem value="Import" update=":importPropertiesForm" oncomplete="PF('importProperties').show();"
                    title="Import Properties" actionListener="#{propertyManager.prepareImportPopup()}"
                    disabled="#{not securityPolicy.getUIHint('PROP_ALL')}" />
            </p:submenu>

            <p:menuitem value="Enumerations" title="View user defined enumerations" url="/enums.xhtml"
                rendered="#{not request.requestURI.endsWith('enums.xhtml')}" icon="ui-icon-radio-off" />
            <p:submenu label="Enumerations" icon="ui-icon-radio-off" rendered="#{request.requestURI.endsWith('enums.xhtml')}"
                    styleClass="menu-selected">
                <p:menuitem value="View" title="View User Defined Enumerations" url="/enums.xhtml" />

                <p:menuitem value="Import" update=":importEnumsForm" oncomplete="PF('importEnums').show();"
                    title="Import Enumerations" actionListener="#{dataTypeManager.prepareImportPopup()}"
                    disabled="#{not securityPolicy.getUIHint('ENUM_ALL')}" />
            </p:submenu>

            <p:menuitem value="Units" title="View units" url="units.xhtml"
                rendered="#{not request.requestURI.endsWith('units.xhtml')}" icon="ui-icon-folder-open" />
            <p:submenu label="Units" icon="ui-icon-folder-open" rendered="#{request.requestURI.endsWith('units.xhtml')}"
                    styleClass="menu-selected">
                <p:menuitem value="View" title="View Units" url="/units.xhtml" />

                <p:menuitem value="Import" update=":importUnitsForm" oncomplete="PF('importUnits').show();"
                    title="Import Units" actionListener="#{unitManager.prepareImportPopup()}"
                    disabled="#{not securityPolicy.getUIHint('UNIT_ALL')}" />
            </p:submenu>

            <p:menuitem value="Log" icon="ui-icon-script" title="View Audit Log" url="/log.xhtml"
                styleClass="#{request.requestURI.endsWith('log.xhtml') ? 'menu-selected' : ''}" />

            <p:submenu label="Templates" icon="ui-icon-calculator">
                <p:menuitem value="Devices" title="Download devices import Excel template"
                    url="/resources/templates/ccdb_devices.xlsx" />
                <p:menuitem value="Device types" title="Download device types import Excel template"
                    url="/resources/templates/ccdb_device_types.xlsx" />
                <p:menuitem value="Properties" title="Download properties import Excel template"
                    url="/resources/templates/ccdb_properties.xlsx" />
                <p:menuitem value="Enumerations" title="Download enumerations import Excel template"
                    url="/resources/templates/ccdb_enumerations.xlsx" />
                <p:menuitem value="Units" title="Download units import Excel template"
                    url="/resources/templates/ccdb_units.xlsx" />
                <p:menuitem value="Signals list" title="Download signals list import Excel template"
                    url="/resources/templates/ccdb_signals_list.xlsx" />
                <p:menuitem value="Installation slots" title="Download installation slots import Excel template"
                    url="/resources/templates/ccdb_slots.xlsx" />
            </p:submenu>

            <p:submenu label="Help" icon="ui-icon-help">
                <p:menuitem value="CCDB conventions" title="Download CCDB conventions" 
                    url="/resources/help/ccdb_conventions.pdf" target="_blank"/>
            </p:submenu>

            <f:facet name="options">
                <rc:logincomp ajax="false" />
            </f:facet>
        </p:menubar>
    </h:form>

    <h:panelGroup rendered="#{request.requestURI.endsWith('units.xhtml')}">
        <ui:include src="../loaders/single-file-DL.xhtml">
            <ui:param name="formId" value="importUnitsForm" />
            <ui:param name="dialogTitle" value="Units import" />
            <ui:param name="widgetName" value="importUnits" />
            <ui:param name="controller" value="#{request.requestURI.endsWith('units.xhtml') ? unitManager : null}" />
        </ui:include>
    </h:panelGroup>

    <h:panelGroup rendered="#{request.requestURI.endsWith('properties.xhtml')}">
        <ui:include src="../loaders/single-file-DL.xhtml">
            <ui:param name="formId" value="importPropertiesForm" />
            <ui:param name="dialogTitle" value="Properties import" />
            <ui:param name="widgetName" value="importProperties" />
            <ui:param name="controller" value="#{request.requestURI.endsWith('properties.xhtml') ? propertyManager : null}" />
        </ui:include>
    </h:panelGroup>

    <h:panelGroup rendered="#{request.requestURI.endsWith('device-types.xhtml')}">
        <ui:include src="../loaders/single-file-DL.xhtml">
            <ui:param name="formId" value="importCompTypesForm" />
            <ui:param name="dialogTitle" value="Device types import" />
            <ui:param name="widgetName" value="importCompTypes" />
            <ui:param name="controller" value="#{request.requestURI.endsWith('device-types.xhtml') ? componentTypeManager : null}" />
        </ui:include>
    </h:panelGroup>

    <h:panelGroup rendered="#{request.requestURI.endsWith('devices.xhtml')}">
        <ui:include src="../loaders/single-file-DL.xhtml">
            <ui:param name="formId" value="importDevicesForm" />
            <ui:param name="dialogTitle" value="Devices import" />
            <ui:param name="widgetName" value="importDevices" />
            <ui:param name="controller" value="#{request.requestURI.endsWith('devices.xhtml') ? devicesController : null}" />
        </ui:include>
    </h:panelGroup>

    <h:panelGroup rendered="#{request.requestURI.endsWith('enums.xhtml')}">
        <ui:include src="../loaders/single-file-DL.xhtml">
            <ui:param name="formId" value="importEnumsForm" />
            <ui:param name="dialogTitle" value="Enumerations import" />
            <ui:param name="widgetName" value="importEnums" />
            <ui:param name="controller" value="#{request.requestURI.endsWith('enums.xhtml') ? dataTypeManager : null}" />
        </ui:include>
    </h:panelGroup>

    <h:panelGroup rendered="#{request.requestURI.endsWith('home.xhtml')}">
        <ui:include src="../loaders/single-file-DL.xhtml">
            <ui:param name="formId" value="importSignalsForm" />
            <ui:param name="dialogTitle" value="Signals import" />
            <ui:param name="widgetName" value="importSignals" />
            <ui:param name="controller" value="#{request.requestURI.endsWith('home.xhtml') ? hierarchiesController : null}" />
        </ui:include>
        <ui:include src="../loaders/single-file-DL.xhtml">
            <ui:param name="formId" value="importSlotsForm" />
            <ui:param name="dialogTitle" value="Slots import" />
            <ui:param name="widgetName" value="importSlots" />
            <ui:param name="controller" value="#{request.requestURI.endsWith('home.xhtml') ? hierarchiesController : null}" />
        </ui:include>
    </h:panelGroup>
</ui:composition>
