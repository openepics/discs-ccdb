<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:ui="http://java.sun.com/jsf/facelets" 
    xmlns:f="http://java.sun.com/jsf/core" 
    xmlns:p="http://primefaces.org/ui" 
    xmlns:rc="http://java.sun.com/jsf/composite/comps" 
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions">

    <h:form id="menuform">
        <script type="text/javascript">
        // <![CDATA[
        function templateDownloadStart() {
            PF('statusDialog').show();
        }
        function templateDownloadStop() {
            PF('statusDialog').hide();
        }
        // ]]>
        </script>
    
        <p:growl id="menumsgs" showDetail="true" />

        <p:menubar id="mainMenu" styleClass="menubar">
        
            <p:submenu label="Home" icon="ui-icon-home" title="Home" 
                    styleClass="#{fn:endsWith(request.requestURL,'home.xhtml') ? 'menu-selected' : ''} homeMenu" >
                <p:menuitem value="View" title="View Home Screen" styleClass="noClickEvent" url="/" />

                <p:menuitem value="Import" update=":importSlotsForm" styleClass="noClickEvent" 
                    oncomplete="PF('importSlots').show();" title="Import Slots and Slot Pairs" 
                    actionListener="#{slotManager.prepareImportPopup()}" 
                    disabled="#{true or         !securityPolicy.getUIHint('SLOT')}" />
            </p:submenu>

            <p:submenu label="Devices" icon="ui-icon-gear" 
                    styleClass="#{fn:endsWith(request.requestURL,'devices.xhtml') ? 'menu-selected' : ''} devicesMenu">
                <p:menuitem value="View" title="View Device Instances" styleClass="noClickEvent" url="/devices.xhtml" />
            
                <p:menuitem value="Import" update=":importDevicesForm" styleClass="noClickEvent" 
                    oncomplete="PF('importDevices').show();" title="Import Device Instances" 
                    actionListener="#{devicesByTypeManager.prepareImportPopup()}" 
                    disabled="#{!securityPolicy.getUIHint('DEVICE')}" />
            </p:submenu>

            <p:submenu label="Device Types" icon="ui-icon-wrench" 
                    styleClass="#{fn:endsWith(request.requestURL,'device-types.xhtml') ? 'menu-selected' : ''} devTypesMenu">
                <p:menuitem value="View" title="View Device Types" styleClass="noClickEvent" url="/device-types.xhtml" />

                <p:menuitem value="Import" update=":importCompTypesForm" styleClass="noClickEvent" 
                    oncomplete="PF('importCompTypes').show();" title="Import Device Types" 
                    actionListener="#{componentTypeManager.prepareImportPopup()}" 
                    disabled="#{!securityPolicy.getUIHint('COMPONENT_TYPE')}" />
            </p:submenu>
            
            <p:submenu label="Properties" icon="ui-icon-contact" 
                    styleClass="#{fn:endsWith(request.requestURL,'properties.xhtml') ? 'menu-selected' : ''} propertiesMenu">
                <p:menuitem value="View" title="View Properties" styleClass="noClickEvent" url="/properties.xhtml" />

                <p:menuitem value="Import" update=":importPropertiesForm" styleClass="noClickEvent" 
                    oncomplete="PF('importProperties').show();" title="Import Properties" 
                    actionListener="#{propertyManager.prepareImportPopup()}" 
                    disabled="#{!securityPolicy.getUIHint('PROPERTY')}" />
            </p:submenu>

            <p:menuitem value="Enumerations" icon="ui-icon-radio-off" title="User Defined Enumerations" 
                url="/enums.xhtml" 
                styleClass="#{fn:endsWith(request.requestURL,'enums.xhtml') ? 'menu-selected' : ''}" />

            <p:submenu label="Units" icon="ui-icon-folder-open"
                    styleClass="#{fn:endsWith(request.requestURL,'units.xhtml') ? 'menu-selected' : ''} unitsMenu">
                <p:menuitem value="View" title="View Units" styleClass="noClickEvent" url="/units.xhtml" />

                <p:menuitem value="Import" update=":importUnitsForm" 
                    oncomplete="PF('importUnits').show();" title="Import Units" styleClass="noClickEvent" 
                    actionListener="#{unitManager.prepareImportPopup()}" 
                    disabled="#{!securityPolicy.getUIHint('UNIT')}" />
            </p:submenu>

            <p:menuitem value="Log" icon="ui-icon-script" title="View Audit Log" url="/log.xhtml" 
                styleClass="#{fn:endsWith(request.requestURL,'log.xhtml') ? 'menu-selected' : ''}" />

            <p:submenu label="Templates" icon="ui-icon-calculator">
                <p:menuitem value="Units" title="Download units import excel template" 
                    url="/resources/import-templates/ccdb_units.xlsx" />
                <p:menuitem value="Properties" title="Download properties import excel template" 
                    url="/resources/import-templates/ccdb_properties.xlsx" />
                <p:menuitem value="Device types" title="Download device types import excel template" 
                    url="/resources/import-templates/ccdb_device_types.xlsx" />
                <p:menuitem value="Devices" title="Download device instances import excel template" 
                    url="/resources/import-templates/ccdb_devices.xlsx" />
            </p:submenu>

            <p:menuitem value="Help" icon="ui-icon-help" title="Help" url="/" disabled="true" />

            <f:facet name="options">
                <rc:logincomp ajax="false" />
            </f:facet>
        </p:menubar>
    </h:form>

    <ui:include src="../loaders/single-file-DL.xhtml">
        <ui:param name="formId" value="importUnitsForm" />
        <ui:param name="dialogTitle" value="Units import" />
        <ui:param name="widgetName" value="importUnits" />
        <ui:param name="controller" value="#{unitManager}" />
    </ui:include>

    <ui:include src="../loaders/single-file-DL.xhtml">
        <ui:param name="formId" value="importPropertiesForm" />
        <ui:param name="dialogTitle" value="Properties import" />
        <ui:param name="widgetName" value="importProperties" />
        <ui:param name="controller" value="#{propertyManager}" />
    </ui:include>

    <ui:include src="../loaders/single-file-DL.xhtml">
        <ui:param name="formId" value="importCompTypesForm" />
        <ui:param name="dialogTitle" value="Device types import" />
        <ui:param name="widgetName" value="importCompTypes" />
        <ui:param name="controller" value="#{componentTypeManager}" />
    </ui:include>

    <ui:include src="../loaders/multiple-files-DL.xhtml">
        <ui:param name="formId" value="importSlotsForm" />
        <ui:param name="dialogTitle" value="Slots and slot pairs import" />
        <ui:param name="widgetName" value="importSlots" />
        <ui:param name="controller" value="#{slotManager}" />
        <ui:param name="firstFileContents" value="slots" />
        <ui:param name="secondFileContents" value="slot pairs" />
    </ui:include>

    <ui:include src="../loaders/single-file-DL.xhtml">
        <ui:param name="formId" value="importDevicesForm" />
        <ui:param name="dialogTitle" value="Devices import" />
        <ui:param name="widgetName" value="importDevices" />
        <ui:param name="controller" value="#{devicesByTypeManager}" />
    </ui:include>

    <script type="text/javascript">
        //<![CDATA[
        function noClickTarget(target) {
            if (target == null) return false;
            if (target.classList && target.classList.contains("noClickEvent")) return true;
            if ((target.nodeName == null) || (target.nodeName == "LI") || (target.nodeName == "UL")) return false;
            return noClickTarget(target.parentNode);
        }
        jQuery(".homeMenu").click(function(event) {
            if (noClickTarget(event.target) == false) {
                window.location.replace("#{request.contextPath}/");
            }
        });
        jQuery(".devicesMenu").click(function(event) {
            if (noClickTarget(event.target) == false) {
                window.location.replace("#{request.contextPath}/devices.xhtml");
            }
        });
        jQuery(".devTypesMenu").click(function(event) {
            if (noClickTarget(event.target) == false) {
                window.location.replace("#{request.contextPath}/device-types.xhtml");
            }
        });
        jQuery(".propertiesMenu").click(function(event) {
            if (noClickTarget(event.target) == false) {
                window.location.replace("#{request.contextPath}/properties.xhtml");
            }
        });
        jQuery(".unitsMenu").click(function(event) {
            if (noClickTarget(event.target) == false) {
                window.location.replace("#{request.contextPath}/units.xhtml");
            }
        });
        // ]]>
    </script>
</ui:composition>
