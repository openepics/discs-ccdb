<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:ui="http://java.sun.com/jsf/facelets" 
    xmlns:f="http://java.sun.com/jsf/core" 
    xmlns:p="http://primefaces.org/ui" 
    xmlns:rc="http://java.sun.com/jsf/composite/comps" 
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions">

    <h:form id="menuform">
        <p:growl id="menumsgs" showDetail="true" />

        <p:menubar id="mainMenu" styleClass="menubar">
            <p:menuitem value="Home" icon="ui-icon-home" title="Home" url="/" 
                styleClass="#{fn:endsWith(request.requestURL,'hierarchies.xhtml') ? 'menu-selected' : ''}" />

            <p:submenu label="Slots" icon="ui-icon-document-b" 
                    styleClass="#{fn:endsWith(request.requestURL,'installation-slots-manager.xhtml') ? 'menu-selected' : ''} slotsMenu">
                <p:menuitem value="View" title="View Installation Slots" styleClass="noClickEvent" 
                    url="/data-definitions/installation-slots/installation-slots-manager.xhtml" />

                <p:menuitem value="Import" update=":importSlotsForm" styleClass="noClickEvent" 
                    oncomplete="importSlots.show()" title="Import Slots and Slot Pairs" 
                    actionListener="#{slotManager.prepareImportPopup()}" 
                    disabled="#{!securityPolicy.getUIHint('SLOT')}"/>
            </p:submenu>

            <p:submenu label="Devices" icon="ui-icon-gear" 
                    styleClass="#{fn:endsWith(request.requestURL,'devices/device-manager.xhtml') ? 'menu-selected' : ''} devicesMenu">
                <p:menuitem value="View" title="View Device Instances" styleClass="noClickEvent" url="/devices/device-manager.xhtml" />
            
                <p:menuitem value="Import" update=":importDevicesForm" styleClass="noClickEvent" 
                    oncomplete="importDevices.show()" title="Import Device Instances" 
                    actionListener="#{deviceManager.prepareImportPopup()}" 
                    disabled="#{!securityPolicy.getUIHint('DEVICE')}"/>
            </p:submenu>

            <p:submenu label="Device Types" icon="ui-icon-wrench" 
                    styleClass="#{fn:endsWith(request.requestURL,'device-types-manager.xhtml') ? 'menu-selected' : ''} devTypesMenu">
                <p:menuitem value="View" title="View Device Types" styleClass="noClickEvent" 
                    url="/data-definitions/device-types/device-types-manager.xhtml" />

                <p:menuitem value="Import" update=":importCompTypesForm" styleClass="noClickEvent" 
                    oncomplete="importCompTypes.show()" title="Import Device Types" 
                    actionListener="#{componentTypeManager.prepareImportPopup()}" 
                    disabled="#{! securityPolicy.getUIHint('COMPONENT_TYPE')}" />
            </p:submenu>
            
            <p:submenu label="Properties" icon="ui-icon-contact" 
                    styleClass="#{fn:endsWith(request.requestURL,'properties-manager.xhtml') ? 'menu-selected' : ''} propertiesMenu">
                <p:menuitem value="View" title="View Properties" styleClass="noClickEvent" 
                    url="/data-definitions/properties/properties-manager.xhtml" />

                <p:menuitem value="Import" update=":importPropertiesForm" styleClass="noClickEvent" 
                    oncomplete="importProperties.show()" title="Import Properties" 
                    actionListener="#{propertyManager.prepareImportPopup()}" 
                    disabled="#{!securityPolicy.getUIHint('PROPERTY')}" />
            </p:submenu>      

            <p:menuitem value="Enumerations" icon="ui-icon-radio-off" title="User Defined Enumerations" 
                url="/data-definitions/enums/enums-manager.xhtml" 
                styleClass="#{fn:endsWith(request.requestURL,'enums-manager.xhtml') ? 'menu-selected' : ''}" />

            <p:submenu label="Units" icon="ui-icon-folder-open"
                    styleClass="#{fn:endsWith(request.requestURL,'units-manager.xhtml') ? 'menu-selected' : ''} unitsMenu">
                <p:menuitem value="View" title="View Units" styleClass="noClickEvent" 
                    url="/data-definitions/units/units-manager.xhtml" />

                <p:menuitem value="Import" update=":importUnitsForm" 
                    oncomplete="importUnits.show()" title="Import Units" styleClass="noClickEvent" 
                    actionListener="#{unitManager.prepareImportPopup()}" 
                    disabled="#{!securityPolicy.getUIHint('UNIT')}" />
            </p:submenu>

            <p:menuitem value="Containers" icon="ui-icon-folder-collapsed" 
                url="/data-definitions/containers/containers-manager.xhtml" 
                styleClass="#{fn:endsWith(request.requestURL,'containers-manager.xhtml') ? 'menu-selected' : ''}" />

            <p:menuitem value="Log" icon="ui-icon-script" title="View Audit Log" url="/audit/log-manager.xhtml" 
                styleClass="#{fn:endsWith(request.requestURL,'log-manager.xhtml') ? 'menu-selected' : ''}" />

            <p:menuitem value="Help" icon="ui-icon-help" title="Help" url="/" disabled="true" />

            <f:facet name="options">
                <rc:logincomp ajax="false" />
            </f:facet>
        </p:menubar>
    </h:form>

    <ui:include src="../loaders/single-file-DL.xhtml">
        <ui:param name="formId" value="importUnitsForm" />
        <ui:param name="dialogTitle" value="Units Import" />
        <ui:param name="widgetName" value="importUnits" />
        <ui:param name="controller" value="#{unitManager}" />
    </ui:include>

    <ui:include src="../loaders/single-file-DL.xhtml">
        <ui:param name="formId" value="importPropertiesForm" />
        <ui:param name="dialogTitle" value="Properties Import" />
        <ui:param name="widgetName" value="importProperties" />
        <ui:param name="controller" value="#{propertyManager}" />
    </ui:include>

    <ui:include src="../loaders/single-file-DL.xhtml">
        <ui:param name="formId" value="importCompTypesForm" />
        <ui:param name="dialogTitle" value="Device Types Import" />
        <ui:param name="widgetName" value="importCompTypes" />
        <ui:param name="controller" value="#{componentTypeManager}" />
    </ui:include>

    <ui:include src="../loaders/multiple-files-DL.xhtml">
        <ui:param name="formId" value="importSlotsForm" />
        <ui:param name="dialogTitle" value="Slots and Slot Pairs Import" />
        <ui:param name="widgetName" value="importSlots" />
        <ui:param name="controller" value="#{slotManager}" />
        <ui:param name="firstFileContents" value="slots" />
        <ui:param name="secondFileContents" value="slot pairs" />
    </ui:include>

    <ui:include src="../loaders/single-file-DL.xhtml">
        <ui:param name="formId" value="importDevicesForm" />
        <ui:param name="dialogTitle" value="Devices Import" />
        <ui:param name="widgetName" value="importDevices" />
        <ui:param name="controller" value="#{deviceManager}" />
    </ui:include>

    <script type="text/javascript">
        //<![CDATA[
        function noClickTarget(target) {
            if (target == null) return false;
            if (target.classList && target.classList.contains("noClickEvent")) return true;
            if ((target.nodeName == null) || (target.nodeName == "LI") || (target.nodeName == "UL")) return false;
            return noClickTarget(target.parentNode);
        }
    
        jQuery(".slotsMenu").click(function(event) {
            if (noClickTarget(event.target) == false) {
                window.location.replace("#{request.contextPath}/data-definitions/installation-slots/installation-slots-manager.xhtml");
            }
        });

        jQuery(".devicesMenu").click(function(event) {
            if (noClickTarget(event.target) == false) {
                window.location.replace("#{request.contextPath}/devices/device-manager.xhtml");
            }
        });

        jQuery(".devTypesMenu").click(function(event) {
            if (noClickTarget(event.target) == false) {
                window.location.replace("#{request.contextPath}/data-definitions/device-types/device-types-manager.xhtml");
            }
        });

        jQuery(".propertiesMenu").click(function(event) {
            if (noClickTarget(event.target) == false) {
                window.location.replace("#{request.contextPath}/data-definitions/properties/properties-manager.xhtml");
            }
        });

        jQuery(".unitsMenu").click(function(event) {
            if (noClickTarget(event.target) == false) {
                window.location.replace("#{request.contextPath}/data-definitions/units/units-manager.xhtml");
            }
        });
        // ]]>
    </script>
</ui:composition>
