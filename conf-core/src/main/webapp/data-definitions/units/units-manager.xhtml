<ui:composition template="/template/template.xhtml" 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui">

    <ui:define name="content">
        <h:form id="unitsForm">
            <p:commandButton ajax="true" actionListener="#{unitManager.prepareAddPopup()}" value="Add new" update=":addUnitForm"
                    oncomplete="addUnit.show()" style="margin-bottom: 1em;" />
            <p:dataTable widgetVar="unitsTableVar" var="unit" id="unitsTable" value="#{unitManager.unitViews}" 
                    resizableColumns="true" style="table-layout: fixed; word-wrap: break-word;" 
                    filteredValue="#{unitManager.filteredUnits}" rows="15" paginator="true" 
                    paginatorPosition="bottom">
                <p:ajax event="filter" ignoreAutoUpdate="true"/>
                <p:column headerText="Name" sortBy="#{unit.name.toUpperCase()}" filterBy="#{unit.name}" width="20%" 
                        filterMatchMode="contains">
                    <h:outputText value="#{unit.name}" />
                </p:column>

                <p:column headerText="Description" sortBy="#{unit.description}" filterBy="#{unit.description}" 
                        width="50%" filterStyle="width: 20em;" filterMatchMode="contains">
                    <h:outputText value="#{unit.description}" />
                </p:column>

                <p:column headerText="Symbol" sortBy="#{unit.symbol}" width="10%" filterBy="#{unit.symbol}" 
                        filterStyle="width: 90%;">
                    <h:outputText value="#{unit.symbol}" />
                </p:column>

                <p:column headerText="Quantity" filterBy="#{unit.quantity}" sortBy="#{unit.quantity}" width="10%" 
                        filterStyle="width: 90%;">
                    <h:outputText value="#{unit.quantity}" />
                </p:column>
                <p:column headerText="Action" style="text-align: center;" width="70">
                    <p:commandLink ajax="true" title="Edit" update=":modifyUnitForm" oncomplete="modifyUnit.show()">
                        <h:outputText styleClass="ui-icon ui-icon-pencil" style="display: inline-block !important; margin-right: 6px;" />
                        <f:setPropertyActionListener value="#{unit}" target="#{unitManager.selectedUnitToModify}" />
                    </p:commandLink>
                    <p:commandLink ajax="true" title="Delete" oncomplete="deleteUnit.show()">
                        <h:outputText styleClass="ui-icon ui-icon-trash" style="display: inline-block !important; margin-right: 6px;" />
                        <f:setPropertyActionListener value="#{unit}" target="#{unitManager.selectedUnit}" />
                    </p:commandLink>
                    <p:commandLink ajax="true" title="Log">
                        <h:outputText styleClass="ui-icon ui-icon-clock" style="display: inline-block !important; margin-right: 6px;" />
                        <p:ajax event="click" listener="#{auditManager.selectEntityForLog(unit.unit, 'UNIT')}" 
                                update=":unitLogForm" oncomplete="unitLog.show()"/>
                    </p:commandLink>
                </p:column>
            </p:dataTable>
        </h:form>

        <ui:include src="../add-or-modify-dialogs/delete-confirmation.xhtml" >
            <ui:param name="formId" value="deleteUnitForm" />
            <ui:param name="dialogTitle" value="Delete unit" />
            <ui:param name="widgetName" value="deleteUnit" />
            <ui:param name="controller" value="#{unitManager}" />
            <ui:param name="submitHandler" value="onDelete" />
            <ui:param name="formToUpdate" value=":unitsForm:unitsTable" />
            <ui:param name="resetFilter" value="unitsTableVar.filter()" />               
        </ui:include>

        <ui:include src="add-or-modify-unit.xhtml">
            <ui:param name="formId" value="modifyUnitForm" />
            <ui:param name="dialogTitle" value="Modify unit" />
            <ui:param name="widgetName" value="modifyUnit" />
            <ui:param name="submitHandler" value="onModify" />
        </ui:include>

        <ui:include src="add-or-modify-unit.xhtml">
            <ui:param name="formId" value="addUnitForm" />
            <ui:param name="dialogTitle" value="Add unit" />
            <ui:param name="widgetName" value="addUnit" />
            <ui:param name="submitHandler" value="onAdd" />
        </ui:include>

        <ui:include src="../../audit/audit-log-table.xhtml">
            <ui:param name="formId" value="unitLogForm" />
            <ui:param name="dialogTitle" value="Unit Log" />
            <ui:param name="widgetName" value="unitLog" />
        </ui:include>

    </ui:define>
</ui:composition>