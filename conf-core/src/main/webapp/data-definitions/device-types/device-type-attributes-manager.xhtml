<ui:composition template="../../template/template.xhtml" 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:rc="http://java.sun.com/jsf/composite/comps"
    xmlns:p="http://primefaces.org/ui">
    <ui:define name="content">
        <h:panelGroup id="deviceTypePropertiesManagerContainer" layout="block" class="container">
            <p:growl showDetail="true" globalOnly="true" autoUpdate="true" />
            <h:form id="deviceTypePropertiesManagerForm" enctype="multipart/form-data">

                <h:panelGroup id="basic-info" layout="block" style="margin-bottom: 1em;">
                    <h3>
                        <h:outputText value="Device type: " />
                        <p:inputText value="#{comptypeAttributesController.entityName}" 
                                size="#{comptypeAttributesController.nameElementSize}"
                                style="font-size: 1em; margin-left: 1em; margin-right: 1em;">
                            <p:ajax event="keyup" update="saveButton" />
                        </p:inputText>
                        <p:commandButton id="saveButton" value="Save changes" type="button" icon="ui-icon-disk" 
                                disabled="#{comptypeAttributesController.entityName == comptypeAttributesController.deviceType.name}">
                            <p:ajax event="click" listener="#{comptypeAttributesController.saveNewName()}" />
                        </p:commandButton>
                    </h3>

                    <h:outputText value="#{comptypeAttributesController.deviceType.description}" />
                </h:panelGroup>

                <h:panelGroup layout="block">
                    <p:commandButton id="addButton" value="Add" type="button" icon="ui-icon-plus" />
                    <p:menu overlay="true" trigger="addButton" my="left top" at="left bottom">
                        <p:menuitem value="Device Type Property" oncomplete="addPropertyValue.show()" 
                            actionListener="#{comptypeAttributesController.prepareForPropertyValueAdd}" 
                            update=":addPropertyValueForm:addPropertyValue" />
                        <p:menuitem value="Installation Slot Property" oncomplete="installationSlotProperty.show()" 
                            actionListener="#{comptypeAttributesController.prepareForSlotPropertyAdd()}" 
                            update=":installationSlotPropertyForm:installationSlotProperty" />
                        <p:menuitem value="Device Instance Property" oncomplete="deviceInstanceProperty.show()" 
                            actionListener="#{comptypeAttributesController.prepareForDevicePropertyAdd()}" 
                            update=":deviceInstancePropertyForm:deviceInstanceProperty" />
                        <p:menuitem value="Tag" oncomplete="deviceTypeTag.show()" update=":deviceTypeTagForm" 
                                   actionListener="#{comptypeAttributesController.prepareForTagAdd}" />
                        <p:menuitem value="Artifact" oncomplete="addArtifact.show()" 
                            actionListener="#{comptypeAttributesController.prepareForArtifactAdd}" 
                            update=":addArtifactForm:addArtifact" />
                    </p:menu>
                    <p:commandButton value="History" icon="ui-icon-clock" style="margin-left: 1ex;">
                        <p:ajax event="click" update=":deviceTypeLogForm" oncomplete="deviceTypeLog.show()" 
                                listener="#{auditManager.selectEntityForLog(comptypeAttributesController.deviceType, 'COMPONENT_TYPE')}" />
                    </p:commandButton>
                    <p:commandButton value="Close" style="margin-left: 1ex;" action="device-types-manager.xhtml?faces-redirect=true" />
                    
                    <rc:attribute-table id="attributesDataTable" controllerBean="#{comptypeAttributesController}" 
                        updateTargets=":modifyPropertyValueForm :modifyArtifactForm" />
                </h:panelGroup>
            </h:form>
        </h:panelGroup>

        <ui:include src="../../audit/audit-log-table.xhtml">
            <ui:param name="formId" value="deviceTypeLogForm" />
            <ui:param name="dialogTitle" value="Device Type Log" />
            <ui:param name="widgetName" value="deviceTypeLog" />
        </ui:include>

        <ui:include src="../../audit/audit-log-details.xhtml">
            <ui:param name="formId" value="logDetailsForm" />
            <ui:param name="dialogTitle" value="Long Entry Details" />
            <ui:param name="widgetName" value="logDetails" />
        </ui:include>

        <ui:include src="../add-or-modify-dialogs/delete-confirmation.xhtml" >
            <ui:param name="formId" value="deleteAttributeForm" />
            <ui:param name="dialogTitle" value="Delete attribute" />
            <ui:param name="widgetName" value="deleteAttribute" />
            <ui:param name="controller" value="#{comptypeAttributesController}" />
            <ui:param name="submitHandler" value="deleteAttribute" />
            <ui:param name="formToUpdate" value=":deviceTypePropertiesManagerContainer" />
            <ui:param name="entityType" value="this attribute" />
        </ui:include>

        <ui:include src="../add-or-modify-dialogs/property-value.xhtml" >
            <ui:param name="formId" value="addPropertyValueForm" />
            <ui:param name="dialogTitle" value="Add new device type property" />
            <ui:param name="widgetName" value="addPropertyValue" />
            <ui:param name="controller" value="#{comptypeAttributesController}" />
            <ui:param name="submitHandler" value="addNewPropertyValue" />
            <ui:param name="componentToUpdate" value=":deviceTypePropertiesManagerForm:attributesDataTable:attributesDataTable" />
        </ui:include>

        <ui:include src="../add-or-modify-dialogs/property-value.xhtml" >
            <ui:param name="formId" value="modifyPropertyValueForm" />
            <ui:param name="dialogTitle" value="Modify device type property" />
            <ui:param name="widgetName" value="modifyPropertyValue" />
            <ui:param name="controller" value="#{comptypeAttributesController}" />
            <ui:param name="submitHandler" value="modifyPropertyValue" />
            <ui:param name="componentToUpdate" value=":deviceTypePropertiesManagerForm:attributesDataTable:attributesDataTable" />
        </ui:include>

        <ui:include src="../add-or-modify-dialogs/builtin-property-value.xhtml" >
            <ui:param name="formId" value="modifyBuiltInPropertyForm" />
            <ui:param name="dialogTitle" value="Modify device type property" />
            <ui:param name="widgetName" value="modifyBuiltInProperty" />
            <ui:param name="controller" value="#{comptypeAttributesController}" />
            <ui:param name="submitHandler" value="modifyBuiltInProperty" />
            <ui:param name="componentToUpdate" value=":deviceTypePropertiesManagerForm:attributesDataTable:attributesDataTable :deviceTypePropertiesManagerForm:basic-info" />
        </ui:include>

        <ui:include src="../add-or-modify-dialogs/property-definition.xhtml" >
            <ui:param name="formId" value="installationSlotPropertyForm" />
            <ui:param name="dialogTitle" value="Add new installation slot property" />
            <ui:param name="widgetName" value="installationSlotProperty" />
            <ui:param name="controller" value="#{comptypeAttributesController}" />
            <ui:param name="submitHandler" value="addNewPropertyValueDefs" />
            <ui:param name="componentToUpdate" value=":deviceTypePropertiesManagerForm:attributesDataTable:attributesDataTable" />
        </ui:include>

        <ui:include src="../add-or-modify-dialogs/property-definition.xhtml" >
            <ui:param name="formId" value="deviceInstancePropertyForm" />
            <ui:param name="dialogTitle" value="Add new device instance property" />
            <ui:param name="widgetName" value="deviceInstanceProperty" />
            <ui:param name="controller" value="#{comptypeAttributesController}" />
            <ui:param name="submitHandler" value="addNewPropertyValueDefs" />
            <ui:param name="componentToUpdate" value=":deviceTypePropertiesManagerForm:attributesDataTable:attributesDataTable" />
        </ui:include>

        <ui:include src="../add-or-modify-dialogs/tag.xhtml" >
            <ui:param name="formId" value="deviceTypeTagForm" />
            <ui:param name="dialogTitle" value="Add new device type tag" />
            <ui:param name="widgetName" value="deviceTypeTag" />
            <ui:param name="controller" value="#{comptypeAttributesController}" />
            <ui:param name="submitHandler" value="addNewTag" />
            <ui:param name="componentToUpdate" value=":deviceTypePropertiesManagerForm:attributesDataTable:attributesDataTable" />
        </ui:include>

        <ui:include src="../add-or-modify-dialogs/artifact.xhtml" >
            <ui:param name="formId" value="addArtifactForm" />
            <ui:param name="dialogTitle" value="Add new device type artifact" />
            <ui:param name="widgetName" value="addArtifact" />
            <ui:param name="controller" value="#{comptypeAttributesController}" />
            <ui:param name="submitHandler" value="addNewArtifact" />
            <ui:param name="componentToUpdate" value=":deviceTypePropertiesManagerForm:attributesDataTable:attributesDataTable" />
        </ui:include>

        <ui:include src="../add-or-modify-dialogs/artifact.xhtml" >
            <ui:param name="formId" value="modifyArtifactForm" />
            <ui:param name="dialogTitle" value="Modify device type artifact" />
            <ui:param name="widgetName" value="modifyArtifact" />
            <ui:param name="controller" value="#{comptypeAttributesController}" />
            <ui:param name="submitHandler" value="modifyArtifact" />
            <ui:param name="componentToUpdate" value=":deviceTypePropertiesManagerForm:attributesDataTable:attributesDataTable" />
        </ui:include>
    </ui:define>
</ui:composition>
