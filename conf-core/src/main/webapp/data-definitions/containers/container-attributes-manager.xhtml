<ui:composition template="../../template/template.xhtml" 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui">
    <ui:define name="content">
        <h:panelGroup id="containerPropertiesManager" layout="block" class="container">
            <p:growl showDetail="true" globalOnly="true" autoUpdate="true"/>
            <h:form id="slotPropertiesManagerForm" enctype="multipart/form-data">

                <h:panelGroup id="basic-info" layout="block" style="margin-bottom: 1em;">
                    <h3>
                        <h:outputText value="Container: " />
                        <p:inputText value="#{slotAttributesController.entityName}" 
                                size="#{slotAttributesController.nameElementSize}" 
                                style="font-size: 1em; margin-left: 1em; margin-right: 1em;">
                            <p:ajax event="keyup" update="saveButton"/>
                        </p:inputText>
                        <p:commandButton id="saveButton" value="Save changes" type="button" icon="ui-icon-disk" 
                                disabled="#{slotAttributesController.entityName == slotAttributesController.slot.name}">
                            <p:ajax event="click" listener="#{slotAttributesController.saveNewName()}" />
                        </p:commandButton>
                    </h3>
                    
                    <p:panelGrid columns="2" styleClass="noBorders noPaddingLeft">
                        <h:outputText value="Parent container:" />
                        <h:outputText value="#{slotAttributesController.parentSlot}" />
                        <h:outputText value="Path:" />
                        <h:outputText value="#{slotAttributesController.slotPath}" style="width: 100%;" />
                    </p:panelGrid>
                    
                </h:panelGroup>

                <h:panelGroup layout="block">
                    <p:commandButton id="addButton" value="Add" type="button" icon="ui-icon-plus"/>
                    <p:menu overlay="true" trigger="addButton" my="left top" at="left bottom">
                        <p:menuitem value="Property" oncomplete="addPropertyValue.show()" 
                                actionListener="#{slotAttributesController.prepareForPropertyValueAdd}" 
                                update=":addPropertyValueForm:addPropertyValue"/>
                        <p:menuitem value="Tag" oncomplete="containerTag.show()" update=":containerTagForm" 
                                actionListener="#{slotAttributesController.prepareForTagAdd}"/>
                        <p:menuitem value="Artifact" oncomplete="addArtifact.show()" 
                                actionListener="#{slotAttributesController.prepareForArtifactAdd}" 
                                update=":addArtifactForm:addArtifact"/>
                    </p:menu>
                    <p:commandButton value="History" icon="ui-icon-clock" style="margin-left: 1ex;">
                       <p:ajax event="click" listener="#{auditManager.selectEntityForLog(slotAttributesController.slot, 'SLOT')}" update=":containerLogForm" oncomplete="containerLog.show()" />
                    </p:commandButton>
                    <p:commandButton value="Close" style="margin-left: 1ex;" action="containers-manager.xhtml?faces-redirect=true" />

                    <p:dataTable id="attributesDataTable" var="attribute" value="#{slotAttributesController.attributes}" 
                            style="table-layout: fixed; word-wrap: break-word; margin-top: 1em;" rows="15" paginator="true" 
                            paginatorPosition="bottom">
                        <p:column headerText="Name" sortBy="#{attribute.name}">
                            <h:outputText value="#{attribute.name}" />
                        </p:column>

                        <p:column headerText="Value" style="width: 30%;">
                            <h:outputText value="#{!empty attribute.value ? attribute.value : '-'}" />
                        </p:column>

                        <p:column headerText="Unit" >
                            <h:outputText value="#{!empty attribute.unit ? attribute.unit.name : '-'}" />
                        </p:column>

                        <p:column headerText="Kind">
                            <h:outputText value="#{attribute.kind.toString()}" />
                        </p:column>

                        <p:column headerText="Data type">
                            <h:outputText value="#{!empty attribute.type ? attribute.type.name : '-'}" />
                        </p:column>

                        <p:column headerText="Actions" width="70">
                            <p:commandLink ajax="true" title="Edit" update=":modifyPropertyValueForm :modifyArtifactForm" 
                                    rendered="#{slotAttributesController.canEdit(attribute)}">
                                <h:outputText styleClass="ui-icon ui-icon-pencil" style="display: inline-block !important; margin-right: 6px;" />
                                <f:setPropertyActionListener value="#{attribute}" target="#{slotAttributesController.selectedAttributeToModify}" />
                            </p:commandLink>
                            <p:commandLink ajax="true" title="Delete"  oncomplete="deleteAttribute.show()" 
                                    rendered="#{slotAttributesController.canDelete(attribute)}">
                                <h:outputText styleClass="ui-icon ui-icon-trash" style="display: inline-block !important; margin-right: 6px;" />
                                <f:setPropertyActionListener value="#{attribute}" target="#{slotAttributesController.selectedAttribute}" />
                            </p:commandLink>
                            <p:commandLink ajax="false" title="Download" rendered="#{attribute.hasFile}">
                                <h:outputText styleClass="ui-icon ui-icon-arrowthick-1-s" style="display: inline-block !important; margin-right: 6px;" />
                                <f:setPropertyActionListener value="#{attribute}" target="#{slotAttributesController.selectedAttribute}" />
                                <p:fileDownload value="#{slotAttributesController.downloadFile}" />
                            </p:commandLink>
                            <h:outputLink rendered="#{attribute.hasURL}" title="Go to URL" target="_blank" value="#{attribute.value}">
                                <h:outputText styleClass="ui-icon ui-icon-extlink" style="display: inline-block !important; margin-right: 6px;" />
                            </h:outputLink>
                        </p:column>
                    </p:dataTable>
                </h:panelGroup>
            </h:form>
        </h:panelGroup>

        <ui:include src="../../audit/audit-log-table.xhtml">
            <ui:param name="formId" value="containerLogForm" />
            <ui:param name="dialogTitle" value="Container Log" />
            <ui:param name="widgetName" value="containerLog" />
        </ui:include>

        <ui:include src="../../audit/audit-log-details.xhtml">
            <ui:param name="formId" value="logDetailsForm" />
            <ui:param name="dialogTitle" value="Long Entry Details" />
            <ui:param name="widgetName" value="logDetails" />
        </ui:include>

        <ui:include src="../add-or-modify-dialogs/delete-confirmation.xhtml" >
            <ui:param name="formId" value="deleteAttributeForm" />
            <ui:param name="dialogTitle" value="Delete attribute" />
            <ui:param name="widgetName" value="deleteAttribute" />
            <ui:param name="controller" value="#{slotAttributesController}" />
            <ui:param name="submitHandler" value="deleteAttribute" />
            <ui:param name="formToUpdate" value=":slotPropertiesManagerForm:attributesDataTable" />
        </ui:include>

        <ui:include src="../add-or-modify-dialogs/property-value.xhtml" >
            <ui:param name="formId" value="addPropertyValueForm" />
            <ui:param name="dialogTitle" value="Add new container property" />
            <ui:param name="widgetName" value="addPropertyValue" />
            <ui:param name="controller" value="#{slotAttributesController}" />
            <ui:param name="submitHandler" value="addNewPropertyValue" />
            <ui:param name="componentToUpdate" value=":slotPropertiesManagerForm:attributesDataTable" />
        </ui:include>

        <ui:include src="../add-or-modify-dialogs/property-value.xhtml" >
            <ui:param name="formId" value="modifyPropertyValueForm" />
            <ui:param name="dialogTitle" value="Modify container property" />
            <ui:param name="widgetName" value="modifyPropertyValue" />
            <ui:param name="controller" value="#{slotAttributesController}" />
            <ui:param name="submitHandler" value="modifyPropertyValue" />
            <ui:param name="componentToUpdate" value=":slotPropertiesManagerForm:attributesDataTable" />
        </ui:include>

        <ui:include src="../add-or-modify-dialogs/builtin-property-value.xhtml" >
            <ui:param name="formId" value="modifyBuiltInPropertyForm" />
            <ui:param name="dialogTitle" value="Modify container property" />
            <ui:param name="widgetName" value="modifyBuiltInProperty" />
            <ui:param name="controller" value="#{slotAttributesController}" />
            <ui:param name="submitHandler" value="modifyBuiltInProperty" />
            <ui:param name="componentToUpdate" value=":slotPropertiesManagerForm:attributesDataTable :slotPropertiesManagerForm:basic-info" />
        </ui:include>

        <ui:include src="../add-or-modify-dialogs/tag.xhtml" >
            <ui:param name="formId" value="containerTagForm" />
            <ui:param name="dialogTitle" value="Add new container tag" />
            <ui:param name="widgetName" value="containerTag" />
            <ui:param name="controller" value="#{slotAttributesController}" />
            <ui:param name="submitHandler" value="addNewTag" />
            <ui:param name="componentToUpdate" value=":slotPropertiesManagerForm:attributesDataTable" />
        </ui:include>

        <ui:include src="../add-or-modify-dialogs/artifact.xhtml" >
            <ui:param name="formId" value="addArtifactForm" />
            <ui:param name="dialogTitle" value="Add new container artifact" />
            <ui:param name="widgetName" value="addArtifact" />
            <ui:param name="controller" value="#{slotAttributesController}" />
            <ui:param name="submitHandler" value="addNewArtifact" />
            <ui:param name="componentToUpdate" value=":slotPropertiesManagerForm:attributesDataTable" />
        </ui:include>

        <ui:include src="../add-or-modify-dialogs/artifact.xhtml" >
            <ui:param name="formId" value="modifyArtifactForm" />
            <ui:param name="dialogTitle" value="Modify container artifact" />
            <ui:param name="widgetName" value="modifyArtifact" />
            <ui:param name="controller" value="#{slotAttributesController}" />
            <ui:param name="submitHandler" value="modifyArtifact" />
            <ui:param name="componentToUpdate" value=":slotPropertiesManagerForm:attributesDataTable" />
        </ui:include>
    </ui:define>
</ui:composition>
