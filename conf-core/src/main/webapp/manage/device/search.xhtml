<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition 
    xmlns:ui="http://java.sun.com/jsf/facelets"   
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://java.sun.com/jsf/core"   
    xmlns:h="http://java.sun.com/jsf/html">              

    <h:form id="searchForm"  prependId="false">
        <p:contextMenu for="searchTable">  
            <p:menuitem value="Add" icon="ui-icon-plus"  update=":slotEditForm :messages" 
                        actionListener="#{deviceManager.onDeviceAdd}"
                        process="@this"  oncomplete="PF('editSlotDialog').show()"/>  
            <p:menuitem value="Edit" icon="ui-icon-pencil" update=":slotEditForm :messages" 
                        actionListener="#{deviceManager.onDeviceEdit}"
                        process="@this searchTable" oncomplete="PF('editDialog').show()"/>  
            <p:menuitem value="Delete" icon="ui-icon-trash"  
                        onclick="PF('deleteConfirm').show()"/>  
        </p:contextMenu>  

        <ui:remove> -------------------------- Search  ------------------- </ui:remove>    

        <p:dataTable id="searchTable" var="item" value="#{deviceManager.objects}" 
                     scrollRows="25" scrollable="true" liveScroll="true"   scrollHeight="200"                  
                     selectionMode="single" selection="#{deviceManager.selectedObject}" 
                     filteredValue="#{deviceManager.filteredObjects}"
                     emptyMessage="No records found!" 
                     rowKey="#{item.deviceId}}" >

            <f:facet name="footer">
                <p:commandButton id="addBtn" value="Add" icon="ui-icon-plus" actionListener="#{deviceManager.onDeviceAdd}"
                                 process="@this" update=":slotEditForm :messages"  oncomplete="PF('editDialog').show()" />
            </f:facet>
            <p:ajax event="rowSelect" listener="#{deviceManager.onDeviceSelect}" update=":detailsPanel :messages" />

            <p:column id="id" headerText="Name" sortBy="#{item.serialNumber}" filterBy="#{item.serialNumber}">
                <h:outputText value="#{item.serialNumber}"/>
            </p:column>
            <p:column id="desc" headerText="Description" filterBy="#{item.description}" filterMatchMode="contains">
                <h:outputText value="#{item.description}"/>
            </p:column>
            <p:column id="type" headerText="Type" sortBy="#{item.componentType.name}" 
                      filterBy="#{item.componentType.name}" filterMatchMode="contains">
                <h:outputText value="#{item.componentType.name}"/>
            </p:column>
            <p:column headerText="Part Of" sortBy="#{item.assemblyParent.serialNumber}" 
                      filterBy="#{item.assemblyParent.serialNumber}" filterMatchMode="contains">
                <h:outputText value="#{item.assemblyParent.serialNumber}"/>
            </p:column>
            <p:column  headerText="Asm Position" >
                <h:outputText value="#{item.assemblyPosition}"/>
            </p:column>
            <p:column  headerText="Asm Comment" >
                <h:outputText value="#{item.assemblyDescription}"/>
            </p:column>
            <p:column  headerText="Manfacturer">
                <h:outputText value="#{item.manufacturer}"/>
            </p:column>
            <p:column  headerText="Manuf Model">
                <h:outputText value="#{item.manufacturerModel}"/>
            </p:column>
            <p:column headerText="PO#">
                <h:outputText value="#{item.purchaseOrder}"/>
            </p:column>
            <p:column  headerText="Status">
                <h:outputText value="#{item.status}"/>
            </p:column>          
            <p:column id="moddate" headerText="Date Modified" rendered="false" >
                <h:outputText value="#{item.modifiedAt}">
                    <f:convertDateTime pattern="#{msgs.dateFormat}" />
                </h:outputText>
            </p:column>
            <p:column id="modby" headerText="Modified By"  rendered="false">
                <h:outputText value="#{item.modifiedBy}" />                      
            </p:column>
        </p:dataTable>

    </h:form>

    <ui:remove> -------------------------- Add/Edit ------------------- </ui:remove>
    <p:dialog  header="Add/Edit a Device" widgetVar="editDialog">
        <h:form id="slotEditForm" prependId="false">
            <p:panelGrid id="itemEditPanel" >
                <p:row>
                    <p:column><h:outputLabel value="Serial Number:" /></p:column>
                    <p:column><h:inputText id="icode" value="#{deviceManager.inputObject.serialNumber}" 
                                           required="true"  /> 
                    </p:column>
                </p:row>
                <p:row>                       
                    <p:column><h:outputLabel value="Description:" /></p:column>
                    <p:column><p:inputTextarea id="desc" value="#{deviceManager.inputObject.description}" 
                                               required="true"   rows="5" cols="50"  /> </p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="Component Type:" /></p:column>
                    <p:column>
                        <p:selectOneMenu  value="#{deviceManager.inputObject.componentType}"   
                                          var="ct" converter="#{componentTypeConverter}" 
                                          filter="true" filterMatchMode="startsWith" required="true">  
                            <f:selectItem itemLabel="Select One"  itemValue="" />
                            <f:selectItems value="#{componentTypeMananger.objects}" var="ctype" itemLabel="#{ctype.name}" itemValue="#{ctype}"/>
                            <p:column>  
                                #{ct.name}
                            </p:column>                                                
                            <p:column >  
                                <h:outputText value="#{ct.description}" />  
                            </p:column> 
                        </p:selectOneMenu>
                    </p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="Manufacturer:" /></p:column>
                    <p:column><h:inputText  value="#{deviceManager.inputObject.manufacturer}"/> </p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="Manuf Model:" /></p:column>
                    <p:column><h:inputText value="#{deviceManager.inputObject.manufacturerModel}"/> </p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="PO:" /></p:column>
                    <p:column><h:inputText  value="#{deviceManager.inputObject.purchaseOrder}"/> </p:column>
                </p:row>
                    
            </p:panelGrid>
            <p:toolbar>
                <p:toolbarGroup  align="right" >                      
                    <p:commandButton value="Save" icon="ui-icon-disk" 
                                     update=":searchForm:searchTable :messages" 
                                     process="@form" actionListener="#{deviceManager.onDeviceSave}"
                                     oncomplete="if (!args.validationFailed &amp;&amp; args.success) PF('editDialog').hide()" /> 
                    <p:separator /> 
                    <p:commandButton value="Cancel" icon="ui-icon-close"                                         
                                     process="@this"  onclick="PF('editDialog').hide()" />
                </p:toolbarGroup>
            </p:toolbar> 
        </h:form>  
    </p:dialog>

    <ui:remove> -------------------------- Delete Confirm ------------------- </ui:remove>
    <p:dialog widgetVar="deleteConfirm">  
        <f:facet name="header">  
            <h:outputText value="Delete Property"/> 
        </f:facet>
        <h:form id="compTypeDelForm" prependId="false">
            <h:outputText value="Do you really want to delete this slot?" />

            <p:separator /> 
            <p:commandButton value="Yes" style="float: left"  
                             icon="ui-icon-check"
                             process="@this" update=":searchForm:searchTable :messages"
                             oncomplete="PF('deleteConfirm').hide()"                                                                
                             actionListener="#{deviceManager.onDeviceDelete}"/> 
            <p:commandButton  type="cancel" value="No" style="float: right"
                              icon="ui-icon-close"
                              update=":messages" process="@this"                                  
                              onclick="PF('deleteConfirm').hide()"  />  
        </h:form>
    </p:dialog>
</ui:composition>
