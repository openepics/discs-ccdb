<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition 
    xmlns:ui="http://java.sun.com/jsf/facelets"
    template="/template/ConfigManagerTemplate.xhtml"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://java.sun.com/jsf/core"   
    xmlns:h="http://java.sun.com/jsf/html">              

    <ui:define name="content">

        <h:form id="propsform">
            <p:growl id="messages" showDetail="true"/>
            <p:contextMenu for="searchTable">  
                <p:menuitem value="Add" icon="ui-icon-plus"  update="managePanel messages" 
                            process="@this" actionListener="#{propertyManager.onAdd}"
                            disabled="true"/>  
                <p:menuitem value="Edit" icon="ui-icon-pencil" update="managePanel messages" 
                            process="@this" actionListener="#{propertyManager.onEdit}"
                            disabled="#{propertyManager.inTrans}"/>  
                <p:menuitem value="Delete" icon="ui-icon-trash"  
                            onclick="PF('deleteConfirm').show()"
                            disabled="#{propertyManager.inTrans}"/>  
            </p:contextMenu>  

            <ui:remove> -------------------------- Search  ------------------- </ui:remove>    
            <p:panel id="searchPanel" header="Search Properties">
                <p:dataTable id="searchTable" var="obj" value="#{propertyManager.objects}" 
                             scrollRows="25" scrollable="true" liveScroll="true"   scrollHeight="200"                  
                             selectionMode="single" selection="#{propertyManager.selectedObject}" 
                             filteredValue="#{propertyManager.filteredObjects}"
                             emptyMessage="No records found!" 
                             rowKey="#{obj.propertyId}}" >

                    <p:ajax event="rowSelect" listener="#{propertyManager.onRowSelect}" update=":propsform:managePanel :propsform:messages" />

                    <p:column id="id" headerText="Name" sortBy="#{obj.name}" 
                              filterBy="#{obj.name}" filterMatchMode="contains">
                        <h:outputText value="#{obj.name}"/>
                    </p:column>
                    <p:column id="desc" headerText="Description" 
                              filterBy="#{obj.description}" filterMatchMode="contains">
                        <h:outputText value="#{obj.description}"/>
                    </p:column>
                    <p:column id="units" headerText="Units" sortBy="#{obj.unit.unitName}" 
                              filterBy="#{obj.unit.unitName}" filterMatchMode="contains">
                        <h:outputText value="#{obj.unit.unitName}"/>
                    </p:column>
                    <p:column id="dtype" headerText="Data Type" sortBy="#{obj.dataType.dataTypeId}" 
                              filterBy="#{obj.dataType.dataTypeId}" filterMatchMode="contains">
                        <h:outputText value="#{obj.dataType.dataTypeId}"/>
                    </p:column>
                    <p:column id="moddate" headerText="Date Modified" rendered="false" >
                        <h:outputText value="#{obj.modifiedAt}">
                            <f:convertDateTime pattern="#{msgs.dateFormat}" />
                        </h:outputText>
                    </p:column>
                    <p:column id="modby" headerText="Modified By"  rendered="false">
                        <h:outputText value="#{obj.modifiedBy}" />                      
                    </p:column>

                </p:dataTable>
            </p:panel>

            <ui:remove> -------------------------- Input Form  ------------------- </ui:remove>
            <p:panel id="managePanel" header="Manage Properties">

                <p:panelGrid id="inputForm" columns="2" styleClass="centered">
                    <h:outputLabel value="Property Name:" />
                    <h:inputText id="icode" value="#{propertyManager.inputObject.name}" 
                                 required="true"  readonly="#{! propertyManager.inTrans}"/> 

                    <h:outputLabel value="Description:" />
                    <p:inputTextarea id="desc" value="#{propertyManager.inputObject.description}" 
                                     required="true" readonly="#{! propertyManager.inTrans}"   rows="5" cols="50"  /> 

                    <h:outputLabel value="Units:" />
                    <p:selectOneMenu id="sunit" value="#{propertyManager.inputObject.unit}"   
                                     var="u" 
                                     converter="#{unitConverter}" rendered="true"
                                     filter="true" filterMatchMode="startsWith">  
                        <f:selectItem itemLabel="Select One" itemValue="" />
                        <f:selectItems value="#{unitManager.units}" var="unit" itemLabel="#{unit.unitName}" itemValue="#{unit}"/>
                        <p:column>  
                            #{u.unitName}
                        </p:column>                        
                        <p:column>  
                            #{u.symbol}
                        </p:column>
                        <p:column>  
                            #{u.quantity}
                        </p:column>
                        <p:column >  
                            <h:outputText value="#{u.description}" />  
                        </p:column> 
                    </p:selectOneMenu>

                    <h:outputLabel value="Data Type:" />                  
                    <p:selectOneMenu id="dtype" value="#{propertyManager.inputObject.dataType}"   
                                     var="d"  required="true"  
                                     converter="#{dataTypeConverter}" rendered="true"
                                     filter="true" filterMatchMode="startsWith">  
                        <f:selectItems value="#{dataTypeManager.dataTypes}" var="dtype" itemLabel="#{dtype.dataTypeId}" itemValue="#{dtype}" />
                        <p:column>  
                            #{d.dataTypeId}
                        </p:column>                        

                        <p:column >  
                            <h:outputText value="#{d.description}" />  
                        </p:column> 
                    </p:selectOneMenu>
                </p:panelGrid>
                <p:focus context="managePanel"/> 
                <p:toolbar id="toolbar">
                    <p:toolbarGroup align="left" >  
                        <p:commandButton value="Add" icon="ui-icon-plus"  update="managePanel messages" 
                                         process="@this" actionListener="#{propertyManager.onAdd}"
                                         disabled="#{propertyManager.inTrans}"/>
                        <p:commandButton value="Edit" icon="ui-icon-pencil" update="managePanel messages" 
                                         process="@this" actionListener="#{propertyManager.onEdit}"
                                         disabled="#{propertyManager.inTrans || propertyManager.selectedObject eq null}"/>

                        <p:commandButton value="View" icon="ui-icon-search" 
                                         update=":viewForm:managePanel"
                                         oncomplete="PF('viewPanel').show()"  rendered="false"/>
                        <p:commandButton value="Delete" icon="ui-icon-trash"  
                                         onclick="PF('deleteConfirm').show()"
                                         disabled="#{propertyManager.inTrans || propertyManager.selectedObject eq null}"/>
                        <p:separator /> 
                    </p:toolbarGroup>
                    <p:toolbarGroup  align="right" >  
                        <p:separator /> 
                        <p:commandButton value="Save" icon="ui-icon-disk" 
                                         update="searchTable managePanel messages" 
                                         process="@this managePanel" actionListener="#{propertyManager.onSave}"
                                         disabled="#{! propertyManager.inTrans}"/>  
                        <p:commandButton value="Cancel" icon="ui-icon-close" 
                                         update="managePanel messages" 
                                         process="@this" actionListener="#{propertyManager.onCancel}"
                                         disabled="#{! propertyManager.inTrans}"/>
                    </p:toolbarGroup>
                </p:toolbar>
            </p:panel>

            <ui:remove> -------------------------- Delete Confirm ------------------- </ui:remove>
            <p:dialog id="deleteConfirm"  widgetVar="deleteConfirm">  
                <f:facet name="header">  
                    <h:outputText value="Delete Property"/> 
                </f:facet>

                <h:outputLabel value="Do you really want to delete this record?" />

                <p:separator /> 
                <p:commandButton value="Yes" style="float: left"  
                                 icon="ui-icon-check"
                                 process="@this managePanel" update="searchTable managePanel messages"
                                 oncomplete="PF('deleteConfirm').hide()"                                                                
                                 actionListener="#{propertyManager.onDelete}"/> 
                <p:commandButton  type="cancel" value="No" style="float: right"
                                  icon="ui-icon-close"
                                  update="managePanel messages" process="@this"                                  
                                  onclick="PF('deleteConfirm').hide()"  />  
            </p:dialog>
        </h:form>      

    </ui:define>
</ui:composition>
