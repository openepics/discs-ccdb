<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition 
    xmlns:ui="http://java.sun.com/jsf/facelets"   
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://java.sun.com/jsf/core"   
    xmlns:h="http://java.sun.com/jsf/html">              

    <h:form id="searchForm"  prependId="false">
        <p:contextMenu for="searchTable">  
            <p:menuitem value="Add" icon="ui-icon-plus"  update=":slotEditForm :messages" 
                        actionListener="#{slotManager.onSlotAdd}"
                        process="@this"  oncomplete="PF('editSlotDialog').show()"/>  
            <p:menuitem value="Edit" icon="ui-icon-pencil" update=":slotEditForm :messages" 
                        actionListener="#{slotManager.onSlotEdit}"
                        process="@this searchTable" oncomplete="PF('editDialog').show()"/>  
            <p:menuitem value="Delete" icon="ui-icon-trash"  
                        onclick="PF('deleteConfirm').show()"/>  
        </p:contextMenu>  

        <ui:remove> -------------------------- Search  ------------------- </ui:remove>    

        <p:dataTable id="searchTable" var="item" value="#{slotManager.objects}" 
                     scrollRows="25" scrollable="true" liveScroll="true"   scrollHeight="200"                  
                     selectionMode="single" selection="#{slotManager.selectedObject}" 
                     filteredValue="#{slotManager.filteredObjects}"
                     emptyMessage="No records found!" 
                     rowKey="#{item.slotId}}" >

            <f:facet name="footer">
                <p:commandButton id="addBtn" value="Add" icon="ui-icon-plus" actionListener="#{slotManager.onSlotAdd}"
                                 process="@this" update=":slotEditForm :messages"  oncomplete="PF('editDialog').show()" />
            </f:facet>
            <p:ajax event="rowSelect" listener="#{slotManager.onSlotSelect}" update=":detailsPanel :messages" />

            <p:column id="id" headerText="Name" sortBy="#{item.name}" 
                      filterBy="#{item.name}" filterMatchMode="contains">
                <h:outputText value="#{item.name}"/>
            </p:column>
            <p:column id="desc" headerText="Description" filterBy="#{item.description}" 
                      filterMatchMode="contains">
                <h:outputText value="#{item.description}"/>
            </p:column>
            <p:column id="type" headerText="Type" sortBy="#{item.componentType.name}" 
                      filterBy="#{item.componentType.name}" filterMatchMode="contains">
                <h:outputText value="#{item.componentType.name}"/>
            </p:column>  
            <p:column headerText="Part Of" sortBy="#{item.assemblySlot.name}" 
                      filterBy="#{item.assemblySlot.name}">
                <h:outputText value="#{item.assemblySlot.name}"/>
            </p:column>
            <p:column  headerText="Part Position" >
                <h:outputText value="#{item.assemblyPosition}"/>
            </p:column>
            <p:column  headerText="Asm Comment" >
                <h:outputText value="#{item.assemblyComment}"/>
            </p:column>
            <p:column headerText="Date Modified" rendered="false" >
                <h:outputText value="#{item.modifiedAt}">
                    <f:convertDateTime pattern="#{msgs.dateFormat}" />
                </h:outputText>
            </p:column>
            <p:column headerText="Modified By"  rendered="false">
                <h:outputText value="#{item.modifiedBy}" />                      
            </p:column>
        </p:dataTable>

    </h:form>

    <p:dialog  header="Add/Edit a Slot" widgetVar="editDialog">
        <h:form id="slotEditForm" prependId="false">
            <p:panelGrid id="itemEditPanel" >
                <p:row>
                    <p:column><h:outputLabel value="Slot Name:" /></p:column>
                    <p:column><h:inputText id="icode" value="#{slotManager.inputObject.name}" 
                                           required="true"  /> 
                    </p:column>
                </p:row>
                <p:row>                       
                    <p:column><h:outputLabel value="Description:" /></p:column>
                    <p:column><p:inputTextarea id="desc" value="#{slotManager.inputObject.description}" 
                                               required="true"   rows="5" cols="50"  /> </p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="Component Type:" /></p:column>
                    <p:column>
                        <p:selectOneMenu  value="#{slotManager.inputObject.componentType}"   
                                          var="ct" converter="#{componentTypeConverter}" 
                                          filter="true" filterMatchMode="startsWith" required="true">  
                            <f:selectItem itemLabel="Select One"  itemValue="" />
                            <f:selectItems value="#{componentTypeMananger.objects}" var="ctype" itemLabel="#{ctype.name}" itemValue="#{ctype}"/>
                            <p:column>  
                                #{ct.name}
                            </p:column>                                                
                            <p:column >  
                                <h:outputText value="#{ct.description}" />  
                            </p:column> 
                        </p:selectOneMenu>
                    </p:column>
                </p:row>
                <p:row>                       
                    <p:column><h:outputLabel value="Hosting Slot:" /></p:column>
                    <p:column><p:selectBooleanCheckbox value="#{slotManager.inputObject.isHostingSlot}"/> </p:column>
                </p:row>
                <p:row>                       
                    <p:column><h:outputLabel value="Desired Alignment:" /></p:column>
                    <p:column>
                        <p:panelGrid columns="6" >
                            <h:outputLabel value="X: " />
                            <p:inputText value="#{slotManager.inputObject.globalX}"/> 
                            <h:outputLabel value="Y: " />
                            <p:inputText value="#{slotManager.inputObject.globalY}"/> 
                            <h:outputLabel value="Z: " />
                            <p:inputText value="#{slotManager.inputObject.globalZ}"/>
                            <h:outputLabel value="Pitch:  " />
                            <p:inputText value="#{slotManager.inputObject.globalPitch}"/> 
                            <h:outputLabel value="Roll: " />
                            <p:inputText value="#{slotManager.inputObject.globalRoll}"/> 
                            <h:outputLabel value="Yaw: " />
                            <p:inputText value="#{slotManager.inputObject.globalYaw}"/>
                        </p:panelGrid>
                    </p:column>
                </p:row>         
            </p:panelGrid>
            <p:toolbar>
                <p:toolbarGroup  align="right" >                      
                    <p:commandButton value="Save" icon="ui-icon-disk" 
                                     update=":searchForm:searchTable :messages" 
                                     process="@form" actionListener="#{slotManager.onSlotSave}"
                                     oncomplete="if (!args.validationFailed &amp;&amp; args.success) PF('editDialog').hide()" /> 
                    <p:separator /> 
                    <p:commandButton value="Cancel" icon="ui-icon-close"                                         
                                     process="@this"  onclick="PF('editDialog').hide()"
                                     />
                </p:toolbarGroup>
            </p:toolbar> 
        </h:form>  
    </p:dialog>

    <ui:remove> -------------------------- Delete Slot Confirm ------------------- </ui:remove>
    <p:dialog widgetVar="deleteConfirm">  
        <f:facet name="header">  
            <h:outputText value="Delete Property"/> 
        </f:facet>
        <h:form id="compTypeDelForm" prependId="false">
            <h:outputText value="Do you really want to delete this slot?" />

            <p:separator /> 
            <p:commandButton value="Yes" style="float: left"  
                             icon="ui-icon-check"
                             process="@this" update="@all"
                             oncomplete="PF('deleteConfirm').hide()"                                                                
                             actionListener="#{slotManager.onSlotDelete}"/> 
            <p:commandButton  type="cancel" value="No" style="float: right"
                              icon="ui-icon-close"
                              update=":messages" process="@this"                                  
                              onclick="PF('deleteConfirm').hide()"  />  
        </h:form>
    </p:dialog>
</ui:composition>
